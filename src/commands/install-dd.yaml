# src/commands/install-dd.yaml

description: |
  Install datadog cli (dog).

  Supports Alpine and debian/ubuntu install methods, sudo is assumed required. Default is Alpine.

parameters:

  os:
    description: OS install type. Default Alpine.
    type: enum
    enum: ["Alpine","Debian"]
    default: Alpine

steps:
  - when:
      condition:
        equal: [ "Alpine", << parameters.os >> ]
      steps:
        - run:
            name: Install datadog cli to Alpine executor
            command: |
              sudo apk add --no-cache python3
              sudo python3 -m ensurepip
              sudo pip3 install --upgrade pip datadog
              sudo ln -sf /usr/bin/pip3 /usr/bin/pip
              sudo ln -sf /usr/bin/pydoc3 /usr/bin/pydoc
              sudo ln -sf /usr/bin/python3 /usr/bin/python
              sudo ln -sf /usr/bin/python3-config /usr/bin/python-config
              # sudo pip install datadog
              dog --version
  - when:
      condition:
        equal: [ "Debian", << parameters.os >> ]
      steps:
        - run:
            name: Install datadog cli to Debian executor
            command: |
              sudo apt-get update
              sudo apt-get install --no-install-recommends -y python3-dev python3-pip
              sudo ln -sf /usr/bin/pydoc3 /usr/bin/pydoc
              sudo ln -sf /usr/bin/python3 /usr/bin/python
              sudo ln -sf /usr/bin/python3-config /usr/bin/python-config
              sudo pip install --no-binary datadog
              dog --version

