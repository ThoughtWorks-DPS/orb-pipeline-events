# src/commands/dd-event.yaml

description: |
  Send custom datadog event message.

parameters:

  date-happened:
    description: POSIX timestamp for the event. Default is current time.
    type: string
    default: "" 
  handle:
    description: Post event as coming from this user. Default is api user.
    type: string
    default: "" 
  priority:
    description: Normal or low priority. Default is normal.
    type: string
    default: normal
  related-event-id:
    description: Set to the id of another event to mark this event as a child.
    type: string
    default: ""
  tags:
    description: Comma delimited, bracketed, list of tags. E.g., { "tag:value", "tag:value" }
    type: string
    default: "" 
  host:
    description: Host name for poster of event. Default is localhost.
    type: string
    default: "" 
  no-host:
    description: Override host and set none.
    type: boolean
    default: false
  device:
    description: Freeform string.
    type: string
    default: "" 
  aggregation-key:
    description: Freeform string
    type: string
    default: "" 
  event-type: 
    description: Event type. Freeform string.
    type: string
    default: "" 
  alert-type:
    description: error, warning, info, success. Default is info
    type: string
    default: info
  title:
    description: Event title.
    type: string
    default: "Pipeline Event"
  message:
    description: Event message
    type: string
    default: "default message: ${CIRCLE_BUILD_URL}"

steps:
  - run:
      name: Post datadog event
      command: |
        dog event post \
          --tags << parameters.tags >> \
          <<#parameters.date-happened>>--date_happened << parameters.date-happened >> <</parameters.date-happened>> \ 
          <<#parameters.handle>>--handle << parameters.handle >> <</parameters.handle>> \
          --priority  << parameters.priority >> \
          <<#parameters.related-event-id>>----related_event_id << parameters.related-event-id >> <</parameters.related-event-id>> \
          <<#parameters.tags>>--tags << parameters.tags >> <</parameters.tags>> \
          <<#parameters.host>>--host << parameters.host >> <</parameters.host>> \
          <<#parameters.no-host>>--no_host <</parameters.no-host>> \
          <<#parameters.device>>--device << parameters.device >> <</parameters.device>> \
          <<#parameters.aggregation-key>>--aggregation_key << parameters.aggregation-key >> <</parameters.aggregation-key>> \
          <<#parameters.event-type>>--type << parameters.event-type >> <</parameters.event-type>> \
          --alert_type << parameters.alert-type >> \
          << parameters.title >> << parameters.message >>
          